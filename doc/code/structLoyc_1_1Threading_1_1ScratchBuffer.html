<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Enhanced C#: Loyc.Threading.ScratchBuffer&lt; T &gt; Struct Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Enhanced C#
   </div>
   <div id="projectbrief">Language of your choice: library documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceLoyc.html">Loyc</a></li><li class="navelem"><a class="el" href="namespaceLoyc_1_1Threading.html">Threading</a></li><li class="navelem"><a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html">ScratchBuffer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Public fields</a> &#124;
<a href="#properties">Properties</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="structLoyc_1_1Threading_1_1ScratchBuffer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Loyc.Threading.ScratchBuffer&lt; T &gt; Struct Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Holds a single Value that is associated with the thread that assigned it. 
 <a href="structLoyc_1_1Threading_1_1ScratchBuffer.html#details">More...</a></p>
<hr/><b>Source file</b>:<ul>
<li><a href='https://github.com/qwertie/ecsharp/tree/master/Core/Loyc.Essentials/Utilities/ThreadEx.cs'>/Core/Loyc.Essentials/Utilities/ThreadEx.cs</a></li>
</ul>
<div class="dynheader">
Inheritance diagram for Loyc.Threading.ScratchBuffer&lt; T &gt;:</div>
<div class="dyncontent">
 <div class="center">
  <img src="structLoyc_1_1Threading_1_1ScratchBuffer.png" usemap="#Loyc.Threading.ScratchBuffer_3C_20T_20_3E_map" alt=""/>
  <map id="Loyc.Threading.ScratchBuffer_3C_20T_20_3E_map" name="Loyc.Threading.ScratchBuffer&lt; T &gt;_map">
<area href="interfaceLoyc_1_1IHasValue.html" alt="Loyc.IHasValue&lt; T &gt;" shape="rect" coords="0,0,215,24"/>
</map>
 </div></div>
<a name="details" id="details"></a><h2 class="groupheader">Remarks</h2>
<div class="textblock"><p>Holds a single Value that is associated with the thread that assigned it.</p>
<p><a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html" title="Holds a single Value that is associated with the thread that assigned it.">ScratchBuffer</a> is typically used as a static variable to hold a temporary object used for operations that are done frequently and require a temporary memory space&ndash;but only during the operation, not afterward. </p>
<p>For example, CPTrie may require a temporary byte array during searches. Re-creating the byte array for every search might cause a too much time to be spent garbage-collecting. On the other hand, if CPTrie keeps a reference to the temporary buffer in itself, what if a program contains many instances of CPTrie? Each one would have its own separate temporary buffer, wasting memory. The buffer can't be a straightforward global variable, either, in case two threads need a scratch buffer at once. <a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html" title="Holds a single Value that is associated with the thread that assigned it.">ScratchBuffer</a>, then, exists to prevent two threads from using the same buffer. </p>
<p><a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html" title="Holds a single Value that is associated with the thread that assigned it.">ScratchBuffer</a> is designed with the assumption that creating a scratch buffer is fast, but re-using an existing buffer is faster. Since creating a scratch buffer is cheap already, this class is worthless unless it is even cheaper. Therefore, it does not hold a buffer for each thread, since managing multiple buffers would be too expensive; and volatile variable access is used instead of locking. </p>
<p><a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html" title="Holds a single Value that is associated with the thread that assigned it.">ScratchBuffer</a> originally returned null if the scratch buffer had not been initialized or was associated with a different thread, requiring the caller to create a new buffer manually. Now there is a new constructor that takes a factory function, which is called automatically by the Value property if the scratch buffer is null or belongs to another thread. If you use this constructor, then you do longer have to worry about Value returning null. </p>
<p>static <a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html" title="Holds a single Value that is associated with the thread that assigned it.">ScratchBuffer</a>&lt;byte[]&gt; _buf = new <a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html" title="Holds a single Value that is associated with the thread that assigned it.">ScratchBuffer</a>&lt;byte[]&gt;(() =&gt; new byte[40]);</p>
<p>// A method called a million times that needs a scratch buffer each time void FrequentOperation() { byte[] buf = _buf.Value;</p>
<p>// do something here involving the buffer ... } </p>
<p>Arguably it is better to use a [ThreadStatic] variable is instead of <a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html" title="Holds a single Value that is associated with the thread that assigned it.">ScratchBuffer</a>, but FWIW [ThreadStatic] is not available on the .NET Compact Framework. </p>
<div class="typeconstraint">
<dl><dt><b>Type Constraints</b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>T</em></td><td>&#160;:</td><td valign="top"><em>class</em></td><td>&#160;</td></tr>
</table>
</dd>
</dl>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public fields</h2></td></tr>
<tr class="memitem:a04792dc87366a23de6a45940d902a4ba"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a04792dc87366a23de6a45940d902a4ba"></a>
volatile int&#160;</td><td class="memItemRight" valign="bottom"><b>_threadID</b></td></tr>
<tr class="separator:a04792dc87366a23de6a45940d902a4ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78306083ad434f553346ccd817e71d84"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a78306083ad434f553346ccd817e71d84"></a>
volatile T&#160;</td><td class="memItemRight" valign="bottom"><b>_buffer</b></td></tr>
<tr class="separator:a78306083ad434f553346ccd817e71d84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80bd4b5373d6854728ebfa3c8a77b9ae"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a80bd4b5373d6854728ebfa3c8a77b9ae"></a>
Func&lt; T &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>_factory</b></td></tr>
<tr class="separator:a80bd4b5373d6854728ebfa3c8a77b9ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="properties"></a>
Properties</h2></td></tr>
<tr class="memitem:ace7a39176d2bf9adddb08cd088cd8a02"><td class="memItemLeft" align="right" valign="top">T&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html#ace7a39176d2bf9adddb08cd088cd8a02">Value</a><code> [get, set]</code></td></tr>
<tr class="memdesc:ace7a39176d2bf9adddb08cd088cd8a02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Please see the documentation of ScratchBuffer&lt;T&gt; itself. <a href="#ace7a39176d2bf9adddb08cd088cd8a02">More...</a><br /></td></tr>
<tr class="separator:ace7a39176d2bf9adddb08cd088cd8a02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header properties_interfaceLoyc_1_1IHasValue"><td colspan="2" onclick="javascript:toggleInherit('properties_interfaceLoyc_1_1IHasValue')"><img src="closed.png" alt="-"/>&#160;Properties inherited from <a class="el" href="interfaceLoyc_1_1IHasValue.html">Loyc.IHasValue&lt; T &gt;</a></td></tr>
<tr class="memitem:a8b63e9edc4a6b4d3877a0621c17be20c inherit properties_interfaceLoyc_1_1IHasValue"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8b63e9edc4a6b4d3877a0621c17be20c"></a>
T&#160;</td><td class="memItemRight" valign="bottom"><b>Value</b><code> [get]</code></td></tr>
<tr class="separator:a8b63e9edc4a6b4d3877a0621c17be20c inherit properties_interfaceLoyc_1_1IHasValue"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8301c5c75d7d37038629e6cd6577a887"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8301c5c75d7d37038629e6cd6577a887"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>ScratchBuffer</b> (Func&lt; T &gt; factory)</td></tr>
<tr class="separator:a8301c5c75d7d37038629e6cd6577a887"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Property Documentation</h2>
<a class="anchor" id="ace7a39176d2bf9adddb08cd088cd8a02"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">T <a class="el" href="structLoyc_1_1Threading_1_1ScratchBuffer.html">Loyc.Threading.ScratchBuffer</a>&lt; T &gt;.Value</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span><span class="mlabel">set</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Please see the documentation of ScratchBuffer&lt;T&gt; itself.</p>

<p>Referenced by <a class="el" href="classLoyc_1_1Localize.html#a43de4c76abc8352800a789b371e15a8e">Loyc.Localize.Localized()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Nov 5 2016 07:35:46 for Enhanced C# by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
