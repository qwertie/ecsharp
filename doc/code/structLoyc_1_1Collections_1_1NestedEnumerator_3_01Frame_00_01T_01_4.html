<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Loyc: Loyc.Collections.NestedEnumerator&lt; Frame, T &gt; Struct Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Loyc
   </div>
   <div id="projectbrief">Language of your choice: library documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceLoyc.html">Loyc</a></li><li class="navelem"><a class="el" href="namespaceLoyc_1_1Collections.html">Collections</a></li><li class="navelem"><a class="el" href="structLoyc_1_1Collections_1_1NestedEnumerator_3_01Frame_00_01T_01_4.html">NestedEnumerator< Frame, T ></a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Public fields</a> &#124;
<a href="#properties">Properties</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="structLoyc_1_1Collections_1_1NestedEnumerator_3_01Frame_00_01T_01_4-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Loyc.Collections.NestedEnumerator&lt; Frame, T &gt; Struct Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Helper class. An enumerator that helps enumerate tree data structures. It maintains a virtual call stack that avoids the performance hit of using nested "yield return" statements in C#. 
 <a href="structLoyc_1_1Collections_1_1NestedEnumerator_3_01Frame_00_01T_01_4.html#details">More...</a></p>
<hr/>Source code:<ul>
<li><a href='https://github.com/qwertie/Loyc/blob/master/Src/Loyc.Essentials/Collections/HelperClasses/NestedEnumerator.cs'>/Src/Loyc.Essentials/Collections/HelperClasses/NestedEnumerator.cs</a></li>
</ul>
<div class="dynheader">
Inheritance diagram for Loyc.Collections.NestedEnumerator&lt; Frame, T &gt;:</div>
<div class="dyncontent">
 <div class="center">
  <img src="structLoyc_1_1Collections_1_1NestedEnumerator_3_01Frame_00_01T_01_4.png" usemap="#Loyc.Collections.NestedEnumerator&lt; Frame, T &gt;_map" alt=""/>
  <map id="Loyc.Collections.NestedEnumerator&lt; Frame, T &gt;_map" name="Loyc.Collections.NestedEnumerator&lt; Frame, T &gt;_map">
</map>
 </div></div>
<a name="details" id="details"></a><h2 class="groupheader">Remarks</h2>
<div class="textblock"><p>Helper class. An enumerator that helps enumerate tree data structures. It maintains a virtual call stack that avoids the performance hit of using nested "yield return" statements in C#.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Frame</td><td>Frame data structure; represents the current 'depth' in a tree data structure, or the current 'stack frame' on a virtual stack. Typically, this parameter will either be EnumeratorFrame{T} or a struct that implements IEnumeratorFrame{Frame, T}.</td></tr>
    <tr><td class="paramname">T</td><td>Item data type returned by the enumerator.</td></tr>
  </table>
  </dd>
</dl>
<p>This data type helps you solve the performance problem with using "yield
return" recursively (). </p>
<p>To illustrate how to use NestedEnumerator{Frame,T} let's consider the case of binary tree traversal. Suppose you define this data structure to hold a subtree of a sorted binary tree of strings: </p><div class="fragment"><div class="line"><span class="keyword">internal</span> <span class="keyword">class </span>StringNode : IEnumerable&amp;lt;string&gt;</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">internal</span> StringNode LeftChild;</div>
<div class="line">    <span class="keyword">internal</span> <span class="keywordtype">string</span> Value;</div>
<div class="line">    <span class="keyword">internal</span> StringNode RightChild;</div>
<div class="line">    <span class="keyword">public</span> IEnumerator&amp;lt;<span class="keywordtype">string</span>&gt; GetEnumerator() { ... }</div>
<div class="line">}</div>
</div><!-- fragment --><p> You want to write an enumerator that returns all the strings in order. So you write this method in the StringNode class: </p><div class="fragment"><div class="line"><span class="keyword">public</span> IEnumerator&amp;lt;<span class="keywordtype">string</span>&gt; GetEnumerator()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">foreach</span>(<span class="keywordtype">string</span> item <span class="keywordflow">in</span> LeftChild)</div>
<div class="line">        yield <span class="keywordflow">return</span> item;</div>
<div class="line">    yield <span class="keywordflow">return</span> Value;</div>
<div class="line">    <span class="keywordflow">foreach</span>(<span class="keywordtype">string</span> item <span class="keywordflow">in</span> RightChild)</div>
<div class="line">        yield <span class="keywordflow">return</span> item;</div>
<div class="line">}</div>
</div><!-- fragment --><p> As explained in <a href="http://stackoverflow.com/questions/3969963/when-not-to-use-yield-return">this web page</a>, this implementation will be slow, and it will get slower and slower as the tree gets deeper. </p>
<p>NestedEnumerator helps to solve this problem using a "virtual stack". It keeps track of all the nested enumerators and always returns values from the current, deepest enumerator. The enumerator objects are called "frames", because they are "stack frames" on the virtual stack. </p>
<p>Each enumerator implements IEnumeratorFrame{Frame,T} instead of just IEnumerator{T}. A normal enumerator can only do one of two actions on each call to MoveNext(): it can return a T value, or stop. But an <code>IEnumeratorFrame</code> can do one of three things: it can return a T value, it can stop, or it can return a new (child) stack frame. These actions are represented by <code>MoveNext</code> return values of 1, 0, and -1 respectively. </p>
<p>You cannot use <code>yield return</code> with <code>NestedEnumerator</code> because it is not supported by the C# compiler, so using <code>NestedEnumerator</code> requires more developer effort. Here's how the GetEnumerator() method can be implemented using <code>NestedEnumerator</code>: </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> IEnumerator&amp;lt;<span class="keywordtype">string</span>&gt; GetEnumerator()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> NestedEnumerator&amp;lt;Frame, <span class="keywordtype">string</span>&gt;(<span class="keyword">new</span> Frame(<span class="keyword">this</span>));</div>
<div class="line">}</div>
<div class="line"><span class="keyword">struct </span>Frame : IEnumeratorFrame&amp;lt;Frame, string&gt;</div>
<div class="line">{</div>
<div class="line">    StringNode <span class="keyword">self</span>;</div>
<div class="line">    <span class="keywordtype">int</span> step;</div>
<div class="line">    <span class="keyword">public</span> Frame(StringNode <span class="keyword">self</span>) { _self = <span class="keyword">self</span>; step = 0; }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> MoveNext(ref Frame frame, ref T current)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">switch</span>(++step) {</div>
<div class="line">            <span class="keywordflow">case</span> 1: frame = <span class="keyword">new</span> Frame(<span class="keyword">self</span>.LeftChild);  <span class="keywordflow">return</span> -1;</div>
<div class="line">            <span class="keywordflow">case</span> 2: current = Value;                    <span class="keywordflow">return</span> 1;</div>
<div class="line">            <span class="keywordflow">case</span> 3: frame = <span class="keyword">new</span> Frame(<span class="keyword">self</span>.RightChild); <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> The <code>NestedEnumerator</code> takes care of managing the stack and invoking <code>MoveNext</code> on the deepest instance of <code>IEnumeratorFrame</code>. </p>
<p>IEnumeratorFrame{Frame,T} is an unusual interface that requires <code>Frame</code> to be derived from the interface itself. The purpose of this design is to allow the <code>Frame</code> data type to be a struct, which allows the virtual stack to consist of value types (structs), which improves performance because a new object does not have to be allocated on the heap for every stack frame. Also, if <code>Frame</code> is a struct, NestedEnumerator can call IEnumeratorFrame{Frame,T}.MoveNext directly, rather than via interface dispatch, which also improves performance. </p>
<div class="typeconstraint">
<dl><dt><b>Type Constraints</b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>Frame</em></td><td>&#160;:</td><td valign="top"><em>IEnumeratorFrame</em></td><td>&#160;</td></tr>
<tr><td valign="top"><em>Frame</em></td><td>&#160;:</td><td valign="top"><em>Frame</em></td><td>&#160;</td></tr>
<tr><td valign="top"><em>Frame</em></td><td>&#160;:</td><td valign="top"><em>T</em></td><td>&#160;</td></tr>
</table>
</dl>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public fields</h2></td></tr>
<tr class="memitem:a364a6cfafcc71e9cc884c5dc13a37c06"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a364a6cfafcc71e9cc884c5dc13a37c06"></a>
T&#160;</td><td class="memItemRight" valign="bottom"><b>_current</b></td></tr>
<tr class="separator:a364a6cfafcc71e9cc884c5dc13a37c06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeed69f6de8303a0edd6986336e14c14f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aeed69f6de8303a0edd6986336e14c14f"></a>
Frame&#160;</td><td class="memItemRight" valign="bottom"><b>_frame</b></td></tr>
<tr class="separator:aeed69f6de8303a0edd6986336e14c14f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2539920acc53dfcbb9b72a04e84ce3d7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2539920acc53dfcbb9b72a04e84ce3d7"></a>
<a class="el" href="classLoyc_1_1Collections_1_1Impl_1_1InternalList.html">InternalList</a>&lt; Frame &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>_stack</b></td></tr>
<tr class="separator:a2539920acc53dfcbb9b72a04e84ce3d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="properties"></a>
Properties</h2></td></tr>
<tr class="memitem:a98a260e1b4ab9e9d2f56a7ebccdac3fa"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a98a260e1b4ab9e9d2f56a7ebccdac3fa"></a>
T&#160;</td><td class="memItemRight" valign="bottom"><b>Current</b><code> [get]</code></td></tr>
<tr class="separator:a98a260e1b4ab9e9d2f56a7ebccdac3fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25277cf6685c2a40d213aa3bce2d1311"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a25277cf6685c2a40d213aa3bce2d1311"></a>
object <br class="typebreak" />
System.Collections.IEnumerator.&#160;</td><td class="memItemRight" valign="bottom"><b>Current</b><code> [get]</code></td></tr>
<tr class="separator:a25277cf6685c2a40d213aa3bce2d1311"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0c879e62b69e3a0714d8a31c69ebabd3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0c879e62b69e3a0714d8a31c69ebabd3"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>NestedEnumerator</b> (Frame root)</td></tr>
<tr class="separator:a0c879e62b69e3a0714d8a31c69ebabd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e8548852899d93e934201ac30694e6a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9e8548852899d93e934201ac30694e6a"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>MoveNext</b> ()</td></tr>
<tr class="separator:a9e8548852899d93e934201ac30694e6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae11b1decb94a36b83831deb384f91e96"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae11b1decb94a36b83831deb384f91e96"></a>
<a class="el" href="structLoyc_1_1void.html">void</a> <br class="typebreak" />
System.Collections.IEnumerator.&#160;</td><td class="memItemRight" valign="bottom"><b>Reset</b> ()</td></tr>
<tr class="separator:ae11b1decb94a36b83831deb384f91e96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e8e9262ecad735cfca833ff9fdb5e8d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7e8e9262ecad735cfca833ff9fdb5e8d"></a>
<a class="el" href="structLoyc_1_1void.html">void</a> IDisposable.&#160;</td><td class="memItemRight" valign="bottom"><b>Dispose</b> ()</td></tr>
<tr class="separator:a7e8e9262ecad735cfca833ff9fdb5e8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jul 6 2014 23:54:32 for Loyc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
